{% extends 'bike_app/_base.html' %}

{% load static %}

{% block content %}


<div class="p-2 mb-0 bg-light text-dark">
    <div class="row">
      <div class="col"></div>
      <div class="col">
          <p class="text-center">  Сортировать по:   </p>  
      </div>
      <div class="col"></div>
    </div>
</div>


<div class="p-0 mb-0 bg-light text-white">
    <div class="row">
      <div class="col"></div>
      <div class="col"></div>

             
            <input class="btn btn-info" type="submit" value="В наличии" id="available"> 
 

        <div class="dropdown">
          <button class="btn btn-info dropdown-toggle" type="button" id="size" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Размер рамы
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item"  id="size_xs">XS</a>
            <a class="dropdown-item"  id="size_s">S</a>
            <a class="dropdown-item"  id="size_m">M</a>
            <a class="dropdown-item"  id="size_l">L</a>
            <a class="dropdown-item"  id="size_xl">XL</a>
            <a class="dropdown-item"  id="size_all">ALL</a>
          </div>
        </div>

         
          <input class="btn btn-info" type="submit" value="Цена" id="price">
      
          
          <input class="btn btn-info" type="submit" value="Брэнд" id="brand">

        <div class="col"></div>
            
              <div class="form-row align-items-center">
                <div class="col-sm-3 my-0">
                  <label class="sr-only" for="inlineFormInput">Price min</label>
                  <input type="text" class="form-control mb-0" id="Price_min" placeholder="Price min" >
                </div>
                <div class="col-sm-3 my-0">
                  <label class="sr-only" for="inlineFormInputGroup">Price max</label>
                  <div class="input-group mb-0">
                     <input type="text" class="form-control" id="Price_max" placeholder="Price max" >
                  </div>
                </div>
               
                <div class="col-auto">
                  <button type="submit" class="btn btn-info mb-0" id="submit_price">OFF</button>
                </div>
              </div>      
      
      <div class="col"></div>
    </div>
</div>



<div class="p-2 mb-0 bg-light text-white">
    <div class="row">
      <div class="col"></div>
      <div class="col">
          <p class="text-center"> <img width="50">  </p>
      </div>
      <div class="col"></div>
    </div>
</div>



  <div class="p-1 mb-0 bg-light text-white" id='my_block'>
      <div class="row">
        <div class="col"></div>
        <div class="col"></div>
        <div class="col">
            {% for bike in bikes_1  %}
                <button type="button" class="btn btn-light"  type="submit" value="Submit" id="{{ bike.name }}">
                    <img src="{% static 'bike_app/bike_models/mountbikes/'  %}{{bike.img_link}}" class="img-fluid" alt="Responsive image" width="200">    
                    <p class="text-center">   <div class="col"> {{ bike.brand }} {{ bike.name }} </div>    </p>
                    <p class="text-center">   <div class="col">  Price - {{ bike.price }}  ₽ </div>    </p>   
                    {% if bike.available %}
                        <p class="text-center">   <div class="col">   </div>    </p>  
                    {% else %}
                        <p class="text-center">   <div class="col">  Нет в наличии </div>    </p>
                    {%endif%}   
                    <p class="text-center">   <div class="col">   </div>    </p>    
                </button>
            {% endfor %}
        </div>
        <div class="col"></div>
        <div class="col">
            {% for bike in bikes_2  %}
                <button type="button" class="btn btn-light"  type="submit" value="Submit" id="{{ bike.name }}">
                    <img src="{% static 'bike_app/bike_models/mountbikes/'  %}{{bike.img_link}}" class="img-fluid" alt="Responsive image" width="200" >  
                    <p class="text-center">   <div class="col"> {{ bike.brand }} {{ bike.name }} </div>    </p>
                    <p class="text-center">   <div class="col">  Price - {{ bike.price }} ₽ </div>    </p>   
                    {% if bike.available %}
                        <p class="text-center">   <div class="col">   </div>    </p>  
                    {% else %}
                        <p class="text-center">   <div class="col">  Нет в наличии </div>    </p>
                    {%endif%}   
                    <p class="text-center">   <div class="col">   </div>    </p>   
                </button>
            {% endfor %}

            {% if table_column %}
                  <img  width="0">                      
                  
            {% endif %}

        </div>
        <div class="col"></div>
        <div class="col"></div>
      </div>
  </div>
     

<script type="application/javascript" src="https://unpkg.com/jquery@3.3.1/dist/jquery.js"></script>


<script type="application/javascript">
    (function (window, document, $) {

        filter = {'available':'', 'price':'', 'brand':'', 'size':'', 'pricemin':'', 'pricemax':'' }
        
        {% if available1  %}
         filter.available = "{{ available1 }}"        
        {% endif %}
        {% if price1  %}
         filter.price = "{{ price1 }}"
        {% endif %}
        {% if brand1  %}
         filter.brand = "{{ brand1 }}"
        {% endif %}
        {% if size1  %}
         filter.size = "{{ size1 }}"
        {% endif %}
        {% if pricemin  %}
         filter.pricemin = "{{ pricemin }}"
        {% endif %}
        {% if pricemax  %}
         filter.pricemax = "{{ pricemax }}"
        {% endif %}


        if (filter.available == 'true') {
            var button = document.getElementById('available')
            button.className = "btn btn-success"
        }

        if (filter.price == 'low') {
            var button = document.getElementById('price')
            button.className = "btn btn-success"
        }
    
        if (filter.price == 'high') {
            var button = document.getElementById('price')
            button.className = "btn btn-danger"
        }

        if (filter.brand == 'true') {
            var button = document.getElementById('brand')
            button.className = "btn btn-success"
        }

        if (filter.size == 'xs') {
            var button = document.getElementById('size')
            button.className = "btn btn-success dropdown-toggle"
            button.innerHTML = '     XS    '
        }
      
        if (filter.size == 'ss') {
              var button = document.getElementById('size')
              button.className = "btn btn-success dropdown-toggle"
              button.innerHTML = '     S    '
          }

        if (filter.size == 'mm') {
            var button = document.getElementById('size')
            button.className = "btn btn-success dropdown-toggle"
            button.innerHTML = '     M    '
        }

        if (filter.size == 'll') {
            var button = document.getElementById('size')
            button.className = "btn btn-success dropdown-toggle"
            button.innerHTML = '     L    '
        }

        if (filter.size == 'xl') {
            var button = document.getElementById('size')
            button.className = "btn btn-success dropdown-toggle"
            button.innerHTML =  "XL"  
        }

         if (filter.pricemin != '' && filter.pricemax != '' && filter.pricemax != 'None' && filter.pricemin != 'None')  {
            console.log('11')
            var button2 = document.getElementById('submit_price')
            button2.className = "btn btn-success mb-0"
            button2.innerHTML =  "ON"
            var button_min = document.getElementById('Price_min')
            var button_max = document.getElementById('Price_max')
            button_min.placeholder = filter.pricemin
            button_max.placeholder = filter.pricemax
        }
 

        
      
        function sendRequest() { 

          var a =''
          for (var key in filter) {
            if (filter[key] && filter[key] != ' ' ){
              a = a + '&' + key +'='+ filter[key]
            }
          }
          
          param = '?' + a
          if (param == '?'){
            param = ''
          }

          new_link = 'http://127.0.0.1:8000/bike/mountbike/'+ param

            var request = $.ajax({
                type:'get',
                url: new_link,
                crossDomain: true,
                data: filter, 
            });

            request.done(function (data) {
                var result = filter;
            })
        }


        document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('available');
            control.addEventListener('click', function (event) {
                if (control.className == "btn btn-info") {
                    filter['available'] = true
                    sendRequest()
                    window.location.href = new_link
                } else {
                  control.className = "btn btn-info";
                  filter['available'] = ''
                  sendRequest()                  
                  window.location.href = new_link
                }
            })
        })
  


     document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('price');
            control.addEventListener('click', function (event) {
                if (control.className == "btn btn-info") {
                    filter['price'] = 'low'
                    sendRequest()
                    window.location.href = new_link
                }
                else if (control.className == "btn btn-success") {
                    filter['price'] = 'high'
                    sendRequest()
                    window.location.href = new_link
                }
                else {
                  control.className = "btn btn-info";
                  filter['price'] = ''
                  sendRequest()
                  window.location.href = new_link
                }
            })
        })
 

     document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('brand');
            control.addEventListener('click', function (event) {
                if (control.className == "btn btn-info") {
                    filter['brand'] = true
                    sendRequest()
                    window.location.href = new_link
                } else {
                  control.className = "btn btn-info";
                  filter['brand'] = ''
                  sendRequest()
                  window.location.href = new_link
                }
            })
        })



        document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('size_xs');
            control.addEventListener('click', function (event) {
                    filter['size'] = 'xs'
                    sendRequest()
                    window.location.href = new_link
            })
        })

        document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('size_s');
            control.addEventListener('click', function (event) {
                    filter['size'] = 'ss'
                    sendRequest()
                    window.location.href = new_link
            })
        })

        document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('size_m');
            control.addEventListener('click', function (event) {
                    filter['size'] = 'mm'
                    sendRequest()
                    window.location.href = new_link
            })
        })


        document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('size_l');
            control.addEventListener('click', function (event) {
                    filter['size'] = 'll'
                    sendRequest()
                    window.location.href = new_link
            })
        })


        document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('size_xl');
            control.addEventListener('click', function (event) {
                    filter['size'] = 'xl'
                    sendRequest()
                    window.location.href = new_link
            })
        })

        document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('size_all');
            control.addEventListener('click', function (event) {
                    filter['size'] = ''
                    sendRequest()
                    window.location.href = new_link
            })
        })



        document.addEventListener('DOMContentLoaded', function () {
            var control = document.getElementById('submit_price');
            var price_min = document.getElementById('Price_min');
            var price_max = document.getElementById('Price_max');
            control.addEventListener('click', function (event) {                    
                    filter['pricemin'] = price_min.value
                    filter['pricemax'] = price_max.value             
                    sendRequest()
                    window.location.href = new_link
            })
        })


        
          function loadNewPage(bike_name) {
            //var previous_page = {'bike_name': bike_name, 'previous_page': window.location.href} 
            var my_url = 'http://127.0.0.1:8000/bike/mountbike/name' + '?' + bike_name

            // var request = $.ajax({
            //     type:'get',
            //     url: my_url,
            //     crossDomain: true,
            //     data: previous_page,
            //     success: function(){  
            //     console.log('success')
            //   }
            // });
            
            // request.done(function (data) {
            //     window.location.href = my_url;
            // })
            

        }


        var elems = document.querySelectorAll('button');

        for (var i = 0; i < elems.length; i++) {
          elems[i].addEventListener("click",function (event) {          
           //loadNewPage(event.currentTarget.id)
        
           
           var counter = 0
           var str_link = ''
           for (var key in filter){
            if (filter[key] == ''){
              counter = counter + 1
            } else{
              str_link =str_link + '&'+ key + '=' + filter[key]
            }
           }
           
           str_link = '?' + str_link


           if (str_link == ''){
              window.location.href = 'http://127.0.0.1:8000/bike/mountbike/name/' + '?' + '*' + event.currentTarget.id;
           } else{
              window.location.href = 'http://127.0.0.1:8000/bike/mountbike/name/' + str_link + '*' + event.currentTarget.id;
           }
     
            })
        }
    })(window, document, jQuery);
</script>

{% endblock %}


